{% extends "components/responsive_table.html" %}

{% block headers %}
<th class="px-4 py-2 text-right">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=item_id&direction={% if sort == 'item_id' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=item_id&direction={% if sort == 'item_id' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='item_id';document.querySelector('#filters input[name=direction]').value='{% if sort == 'item_id' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    ID{% if sort == 'item_id' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
  </a>
  </th>
  <th class="px-4 py-2">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=name&direction={% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=name&direction={% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='name';document.querySelector('#filters input[name=direction]').value='{% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Name{% if sort == 'name' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
    </a>
  </th>
<th class="px-4 py-2">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=base_unit&direction={% if sort == 'base_unit' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=base_unit&direction={% if sort == 'base_unit' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='base_unit';document.querySelector('#filters input[name=direction]').value='{% if sort == 'base_unit' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Base Unit{% if sort == 'base_unit' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
    </a>
  </th>
<th class="px-4 py-2 text-right">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=current_stock&direction={% if sort == 'current_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=current_stock&direction={% if sort == 'current_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='current_stock';document.querySelector('#filters input[name=direction]').value='{% if sort == 'current_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Current Stock{% if sort == 'current_stock' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
    </a>
  </th>
<th class="px-4 py-2 text-right">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=reorder_point&direction={% if sort == 'reorder_point' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=reorder_point&direction={% if sort == 'reorder_point' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='reorder_point';document.querySelector('#filters input[name=direction]').value='{% if sort == 'reorder_point' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Reorder Point{% if sort == 'reorder_point' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
    </a>
  </th>
<th class="px-4 py-2">Stock Level</th>
<th class="px-4 py-2">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=is_active&direction={% if sort == 'is_active' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=is_active&direction={% if sort == 'is_active' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='is_active';document.querySelector('#filters input[name=direction]').value='{% if sort == 'is_active' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Active{% if sort == 'is_active' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
  </a>
</th>
<th class="px-4 py-2">Actions</th>
{% endblock %}

{% block rows %}
{% for row in page_obj %}
<tr class="odd:bg-gray-50 hover:bg-gray-100">
  <td class="px-4 py-2 text-right">{{ row.item_id }}</td>
  <td class="px-4 py-2">{{ row.name }}</td>
  <td class="px-4 py-2">{{ row.base_unit }}</td>
  <td class="px-4 py-2 text-right">{{ row.current_stock }}</td>
  <td class="px-4 py-2 text-right">{{ row.reorder_point }}</td>
  <td class="px-4 py-2 text-center">
    <span class="inline-block w-3 h-3 rounded-full {% if row.stock_ok %}bg-green-600{% else %}bg-red-600{% endif %}" aria-label="{% if row.stock_ok %}In Stock{% else %}Low Stock{% endif %}"></span>
  </td>
  <td class="px-4 py-2 text-center">
    <form
      hx-post="{% url 'item_toggle_active' row.item_id %}"
      hx-target="#items_table"
      hx-confirm="Are you sure you want to toggle this item?"
      method="post"
      class="inline"
    >
      {% csrf_token %}
      <input type="hidden" name="q" value="{{ q }}" />
      <input type="hidden" name="page" value="{{ page_obj.number }}" />
      <input type="hidden" name="active" value="{{ active }}" />
      <input type="hidden" name="page_size" value="{{ page_size }}" />
      <input type="hidden" name="sort" value="{{ sort }}" />
      <input type="hidden" name="direction" value="{{ direction }}" />
      <button type="submit" title="Toggle">
        {% if row.is_active %}
        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M5 13l4 4L19 7"/></svg>
        <span class="sr-only">Deactivate</span>
        {% else %}
        <svg class="w-5 h-5 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 18L18 6M6 6l12 12"/></svg>
        <span class="sr-only">Activate</span>
        {% endif %}
      </button>
    </form>
  </td>
  <td class="px-4 py-2">
    <div class="flex gap-2">
      <a href="{% url 'item_detail' row.item_id %}" class="text-primary" title="View">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.036 12.322a1 1 0 010-.644C3.423 7.51 7.373 4.5 12 4.5c4.628 0 8.578 3.01 9.964 7.178a1 1 0 010 .644C20.578 16.49 16.628 19.5 12 19.5c-4.628 0-8.578-3.01-9.964-7.178z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        <span class="sr-only">View</span>
      </a>
      <a href="{% url 'item_edit' row.item_id %}" class="text-primary" title="Edit">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11.25 3.75h-6a1.5 1.5 0 00-1.5 1.5v13.5a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5v-6"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 3.75L20.25 9M7.5 9h3.75a.75.75 0 01.75.75V13.5"/></svg>
        <span class="sr-only">Edit</span>
      </a>
      <a href="{% url 'item_delete' row.item_id %}" class="text-red-600" title="Delete">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5-4h4a1 1 0 011 1v1h3m-12 0h3v1a1 1 0 001 1h4a1 1 0 001-1V5h3M4 7h16"/></svg>
        <span class="sr-only">Delete</span>
      </a>
    </div>
  </td>
</tr>
{% empty %}
<tr>
  <td colspan="8" class="px-4 py-2">
    {% url 'item_create' as item_create_url %}
    {% include "components/empty_state.html" with title="No Items" message="No items found." cta_label="New Item" cta_url=item_create_url %}
  </td>
</tr>
{% endfor %}
{% endblock %}

{% block footer %}
<div class="flex items-center gap-4 mt-4 flex-wrap">
    {% url 'items_table' as table_url %}
    {% with extra_query='q='|add:q|urlencode|add:'&active='|add:active|urlencode|add:'&page_size='|add:page_size|add:'&sort='|add:sort|urlencode|add:'&direction='|add:direction|urlencode %}
      {% include "components/pagination.html" with page_obj=page_obj base_url=table_url extra_query=extra_query hx_target="#items_table" hx_include="#filters" %}
    {% endwith %}
  <div class="ml-auto flex items-center gap-2">
      <label for="page_size" class="text-sm font-medium">Per page:</label>
    <input
      type="text"
      id="page_size"
      name="page_size"
      list="page_size_options"
      class="pagination-input"
      value="{{ page_size }}"
      form="filters"
      hx-get="{% url 'items_table' %}"
      hx-target="#items_table"
      hx-trigger="change"
      hx-include="#filters"
    />
    <datalist id="page_size_options">
      <option value="10"></option>
      <option value="25"></option>
      <option value="50"></option>
      <option value="100"></option>
    </datalist>
  </div>
</div>
{% endblock %}
