{% extends "_base.html" %}
{% block content %}
<div class="max-w-5xl mx-auto p-4">
  <h1 class="text-2xl font-semibold mb-4">History Reports</h1>
    <form method="get" class="flex flex-wrap gap-2 mb-4">
      <select name="item" class="form-control">
        <option value="">All Items</option>
      {% for it in items %}
      <option value="{{ it.item_id }}" {% if item|default:'' == it.item_id|stringformat:"s" %}selected{% endif %}>{{ it.name }}</option>
      {% endfor %}
      </select>
      <select name="type" class="form-control">
      <option value="">All Types</option>
      {% for t in transaction_types %}
      <option value="{{ t }}" {% if type == t %}selected{% endif %}>{{ t }}</option>
      {% endfor %}
      </select>
      <select name="user" class="form-control">
      <option value="">All Users</option>
      {% for u in users %}
      <option value="{{ u }}" {% if user == u %}selected{% endif %}>{{ u }}</option>
      {% endfor %}
      </select>
      <input type="date" name="start_date" value="{{ start_date }}" class="form-control" />
      <input type="date" name="end_date" value="{{ end_date }}" class="form-control" />
    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded">Filter</button>
    <a href="?{% if query_string %}{{ query_string }}&{% endif %}export=csv" class="px-4 py-2 border rounded">Export CSV</a>
  </form>
    <div class="overflow-x-auto">
      <table class="table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Item</th>
            <th>Type</th>
            <th>Qty</th>
            <th>User</th>
            <th>Date</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          {% for row in page_obj %}
          <tr>
            <td>{{ row.transaction_id }}</td>
            <td>{{ row.item.name }}</td>
            <td>{{ row.transaction_type }}</td>
            <td>{{ row.quantity_change }}</td>
            <td>{{ row.user_id }}</td>
            <td>{{ row.transaction_date }}</td>
            <td>{{ row.notes }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="7" class="p-2">No transactions found.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  <div class="flex items-center gap-3 mt-3">
    {% if page_obj.has_previous %}
    <a href="?{% if query_string %}{{ query_string }}&{% endif %}page={{ page_obj.previous_page_number }}" class="px-3 py-1 border rounded">Prev</a>
    {% endif %}
    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
    <a href="?{% if query_string %}{{ query_string }}&{% endif %}page={{ page_obj.next_page_number }}" class="px-3 py-1 border rounded">Next</a>
    {% endif %}
  </div>
</div>
{% endblock %}
