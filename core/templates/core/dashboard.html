{% extends "_base.html" %}
{% block content %}
<h1 class="text-h1">Dashboard</h1>

<div id="kpi-cards" hx-get="{% url 'dashboard-kpis' %}" hx-trigger="load"></div>

<div class="flex gap-4">
  {% if perms.inventory.add_purchaseorder %}
    <a href="{% url 'purchase_order_create' %}" class="btn-primary px-4 py-2 rounded">New PO</a>
  {% endif %}
  <a href="{% url 'grn_list' %}" class="btn-secondary px-4 py-2 rounded">Record Receipt</a>
</div>

<div>
  <canvas id="stock-trend-chart" class="w-full h-64"></canvas>
  <script>
    const ctx = document.getElementById('stock-trend-chart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: {{ trend_labels|safe }},
        datasets: [{
          label: 'Stock Trend',
          data: {{ trend_values|safe }},
          borderColor: '#3b82f6',
          backgroundColor: 'rgba(59,130,246,0.2)',
          tension: 0.4,
        }]
      },
      options: {responsive: true, maintainAspectRatio: false}
    });
  </script>
</div>

<h2 class="text-h2 mb-2">Low Stock Items</h2>
<ul class="space-y-2">
  {% for item in low_stock %}
    <li class="flex items-center justify-between p-4 rounded border">
      <div class="flex items-center gap-2">
        <svg aria-hidden="true" class="w-5 h-5 text-danger" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/></svg>
        <span>{{ item.name }}</span>
      </div>
      <span class="badge-warning">{{ item.current_stock }} / {{ item.reorder_point }}</span>
    </li>
  {% empty %}
    <li class="p-4 border rounded">No low stock items.</li>
  {% endfor %}
</ul>
{% endblock %}
