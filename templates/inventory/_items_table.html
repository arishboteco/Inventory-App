<div class="overflow-x-auto">
  <table class="table">
    <thead>
      <tr>
        <th>
          <a hx-get="{% url 'items_table' %}?sort=item_id&direction={% if sort == 'item_id' and direction == 'asc' %}desc{% else %}asc{% endif %}"
             hx-target="#items_table" hx-include="#filters"
             hx-on:click="document.querySelector('#filters input[name=sort]').value='item_id';document.querySelector('#filters input[name=direction]').value='{% if sort == 'item_id' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
            ID{% if sort == 'item_id' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
          </a>
        </th>
        <th>
          <a hx-get="{% url 'items_table' %}?sort=name&direction={% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}"
             hx-target="#items_table" hx-include="#filters"
             hx-on:click="document.querySelector('#filters input[name=sort]').value='name';document.querySelector('#filters input[name=direction]').value='{% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
            Name{% if sort == 'name' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
          </a>
        </th>
        <th>
          <a hx-get="{% url 'items_table' %}?sort=base_unit&direction={% if sort == 'base_unit' and direction == 'asc' %}desc{% else %}asc{% endif %}"
             hx-target="#items_table" hx-include="#filters"
             hx-on:click="document.querySelector('#filters input[name=sort]').value='base_unit';document.querySelector('#filters input[name=direction]').value='{% if sort == 'base_unit' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
            Base Unit{% if sort == 'base_unit' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
          </a>
        </th>
        <th>
          <a hx-get="{% url 'items_table' %}?sort=category&direction={% if sort == 'category' and direction == 'asc' %}desc{% else %}asc{% endif %}"
             hx-target="#items_table" hx-include="#filters"
             hx-on:click="document.querySelector('#filters input[name=sort]').value='category';document.querySelector('#filters input[name=direction]').value='{% if sort == 'category' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
            Category{% if sort == 'category' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
          </a>
        </th>
        <th>
          <a hx-get="{% url 'items_table' %}?sort=sub_category&direction={% if sort == 'sub_category' and direction == 'asc' %}desc{% else %}asc{% endif %}"
             hx-target="#items_table" hx-include="#filters"
             hx-on:click="document.querySelector('#filters input[name=sort]').value='sub_category';document.querySelector('#filters input[name=direction]').value='{% if sort == 'sub_category' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
            Subcategory{% if sort == 'sub_category' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
          </a>
        </th>
        <th class="text-right">
          <a hx-get="{% url 'items_table' %}?sort=current_stock&direction={% if sort == 'current_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}"
             hx-target="#items_table" hx-include="#filters"
             hx-on:click="document.querySelector('#filters input[name=sort]').value='current_stock';document.querySelector('#filters input[name=direction]').value='{% if sort == 'current_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
            Current Stock{% if sort == 'current_stock' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
          </a>
        </th>
        <th class="text-right">
          <a hx-get="{% url 'items_table' %}?sort=reorder_point&direction={% if sort == 'reorder_point' and direction == 'asc' %}desc{% else %}asc{% endif %}"
             hx-target="#items_table" hx-include="#filters"
             hx-on:click="document.querySelector('#filters input[name=sort]').value='reorder_point';document.querySelector('#filters input[name=direction]').value='{% if sort == 'reorder_point' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
            Reorder Point{% if sort == 'reorder_point' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
          </a>
        </th>
        <th>
          <a hx-get="{% url 'items_table' %}?sort=is_active&direction={% if sort == 'is_active' and direction == 'asc' %}desc{% else %}asc{% endif %}"
             hx-target="#items_table" hx-include="#filters"
             hx-on:click="document.querySelector('#filters input[name=sort]').value='is_active';document.querySelector('#filters input[name=direction]').value='{% if sort == 'is_active' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
            Active{% if sort == 'is_active' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
          </a>
        </th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for row in page_obj %}
      <tr>
        <td>{{ row.item_id }}</td>
        <td>{{ row.name }}</td>
        <td>{{ row.base_unit }}</td>
        <td>{{ row.category }}</td>
        <td>{{ row.sub_category }}</td>
        <td class="text-right">{{ row.current_stock }}</td>
        <td class="text-right">{{ row.reorder_point }}</td>
        <td>{{ row.is_active }}</td>
        <td>
          <a href="{% url 'item_detail' row.item_id %}" class="text-blue-600 mr-2">View</a>
          <a href="{% url 'item_edit' row.item_id %}" class="text-blue-600 mr-2">Edit</a>
          <a href="{% url 'item_delete' row.item_id %}" class="text-blue-600">Delete/Deactivate</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="9">
          <div class="text-center py-6 text-gray-500">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            <p class="mt-2">No items found.</p>
            <a href="{% url 'item_create' %}" class="mt-2 inline-block text-blue-600 underline">Create the first item</a>
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<div class="flex items-center gap-3 mt-3 flex-wrap">
  <div class="flex items-center gap-1">
    {% if page_obj.has_previous %}
      <a hx-get="{% url 'items_table' %}?page={{ page_obj.previous_page_number }}&q={{ q|urlencode }}&category={{ category|urlencode }}&subcategory={{ subcategory|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort={{ sort|urlencode }}&direction={{ direction|urlencode }}" hx-target="#items_table" class="px-3 py-1 border rounded">Prev</a>
    {% endif %}
    {% for num in page_obj.paginator.page_range %}
      {% if num == page_obj.number %}
        <span class="px-3 py-1 border rounded bg-gray-200">{{ num }}</span>
      {% else %}
        <a hx-get="{% url 'items_table' %}?page={{ num }}&q={{ q|urlencode }}&category={{ category|urlencode }}&subcategory={{ subcategory|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort={{ sort|urlencode }}&direction={{ direction|urlencode }}" hx-target="#items_table" class="px-3 py-1 border rounded">{{ num }}</a>
      {% endif %}
    {% endfor %}
    {% if page_obj.has_next %}
      <a hx-get="{% url 'items_table' %}?page={{ page_obj.next_page_number }}&q={{ q|urlencode }}&category={{ category|urlencode }}&subcategory={{ subcategory|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort={{ sort|urlencode }}&direction={{ direction|urlencode }}" hx-target="#items_table" class="px-3 py-1 border rounded">Next</a>
    {% endif %}
  </div>
  <div class="ml-auto flex items-center gap-2">
    <label for="page_size" class="text-sm">Per page:</label>
    <select id="page_size" name="page_size" class="border rounded p-1" hx-get="{% url 'items_table' %}" hx-target="#items_table" hx-trigger="change" hx-include="#filters" hx-on:change="document.querySelector('#filters input[name=page_size]').value=this.value">
      <option value="10" {% if page_size == 10 %}selected{% endif %}>10</option>
      <option value="25" {% if page_size == 25 %}selected{% endif %}>25</option>
      <option value="50" {% if page_size == 50 %}selected{% endif %}>50</option>
      <option value="100" {% if page_size == 100 %}selected{% endif %}>100</option>
    </select>
  </div>
</div>
