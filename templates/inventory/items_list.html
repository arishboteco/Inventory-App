{% extends "components/list_layout.html" %}
{% block title %}Items â€“ Inventory App{% endblock %}
{% block heading %}Items{% endblock %}
{% block actions %}
  <a href="{% url 'item_create' %}" class="btn-primary">New Item</a>
  <a href="{% url 'items_bulk_upload' %}" class="btn-secondary">Bulk Upload</a>
{% endblock %}
{% block filter_bar %}
  {% url 'items_table' as items_table_url %}
  {% include "components/filter_bar.html" with search_placeholder="Search items..." hx_get=items_table_url hx_target="#items_table" hx_indicator="#htmx-spinner" filters=filters export_url=export_url sort=sort direction=direction %}
{% endblock %}
{% block extra %}
  {{ categories_map|json_script:"categories-data" }}
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const categories = JSON.parse(
        document.getElementById('categories-data').textContent
      );
      const categorySelect = document.getElementById('filter-category');
      const subSelect = document.getElementById('filter-subcategory');

      function refreshSubcategories(selected) {
        const cat = categorySelect.value;
        const options = categories[cat] || [];
        subSelect.innerHTML = '<option value="">All</option>';
        options.forEach(function (opt) {
          const o = document.createElement('option');
          o.value = opt.name;
          o.textContent = opt.name;
          subSelect.appendChild(o);
        });
        if (
          selected &&
          options.some(function (o) {
            return o.name === selected;
          })
        ) {
          subSelect.value = selected;
        } else {
          subSelect.value = '';
        }
      }

      const initialSub = subSelect.value;
      refreshSubcategories(initialSub);
      categorySelect.addEventListener('change', function () {
        refreshSubcategories();
      });
    });
  </script>
  <a
    href="{% url 'item_create' %}"
    class="md:hidden fixed bottom-4 right-4 btn-primary rounded-full w-12 h-12 flex items-center justify-center shadow-lg"
    aria-label="Add Item"
  >
    +
  </a>
{% endblock %}
{% block table_id %}items_table{% endblock %}
{% block hx_get %}{% url 'items_table' %}{% endblock %}
{% block table_content %}{{ items_table|safe }}{% endblock %}
