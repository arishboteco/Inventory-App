{% extends "components/form_layout.html" %}
{% block title %}{% if is_edit %}Edit{% else %}New{% endif %} Purchase Order â€“ Inventory App{% endblock %}
{% block heading %}{% if is_edit %}Edit{% else %}New{% endif %} Purchase Order{% endblock %}
{% block form_attrs %}id="po-form"{% endblock %}
{% block fields %}
  <div class="grid gap-4 grid-cols-2 max-sm:grid-cols-1">
    {% for field in form %}
      {% include "components/form_field.html" with field=field %}
    {% endfor %}
  </div>
  <datalist id="supplier-options"></datalist>
  <div id="items-formset">
    {{ formset.management_form }}
    {% if formset.non_form_errors %}
      <ul class="text-red-600 list-disc pl-5">
        {% for error in formset.non_form_errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    {% endif %}
    {% for f in formset %}
    <div class="border p-2 item-form">
      {% if f.non_field_errors %}
        <ul class="text-red-600 list-disc pl-5">
          {% for error in f.non_field_errors %}<li>{{ error }}</li>{% endfor %}
        </ul>
      {% endif %}
      {% for field in f %}
        {% include "components/form_field.html" with field=field %}
      {% endfor %}
    </div>
    {% endfor %}
  </div>
  <datalist id="item-options"></datalist>
  <div>
    <button type="button" id="add-item" class="btn-secondary">Add Item</button>
  </div>
{% endblock %}
{% block submit_text %}Save{% endblock %}
{% block back_url %}{% url 'purchase_orders_list' %}{% endblock %}
{% block back_text %}Cancel{% endblock %}
{% block extra %}
  <template id="item-empty-form">
    <div class="border p-2 item-form">
      {% for field in formset.empty_form %}
        {% include "components/form_field.html" with field=field %}
      {% endfor %}
    </div>
  </template>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      initFormset({
        formsetPrefix: '{{ formset.prefix }}',
        addButtonId: 'add-item',
        formContainer: '#items-formset',
        formClass: 'item-form',
        templateId: 'item-empty-form'
      });
      document.getElementById('po-form').addEventListener('submit', function (e) {
        if (!this.checkValidity()) {
          e.preventDefault();
          this.reportValidity();
        }
      });
    });
  </script>
{% endblock %}
{% block no_form %}<p>Unable to load form.</p>{% endblock %}

