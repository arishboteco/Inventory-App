{% extends "components/table.html" %}

{% block headers %}
<th class="px-4 py-2 text-right">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=item_id&direction={% if sort == 'item_id' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=item_id&direction={% if sort == 'item_id' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='item_id';document.querySelector('#filters input[name=direction]').value='{% if sort == 'item_id' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    ID{% if sort == 'item_id' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
  </a>
  </th>
  <th class="px-4 py-2">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=name&direction={% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=name&direction={% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='name';document.querySelector('#filters input[name=direction]').value='{% if sort == 'name' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Name{% if sort == 'name' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
    </a>
  </th>
<th class="px-4 py-2">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=base_unit&direction={% if sort == 'base_unit' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=base_unit&direction={% if sort == 'base_unit' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='base_unit';document.querySelector('#filters input[name=direction]').value='{% if sort == 'base_unit' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Base Unit{% if sort == 'base_unit' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
    </a>
  </th>
<th class="px-4 py-2 text-right">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=current_stock&direction={% if sort == 'current_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=current_stock&direction={% if sort == 'current_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='current_stock';document.querySelector('#filters input[name=direction]').value='{% if sort == 'current_stock' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Current Stock{% if sort == 'current_stock' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
    </a>
  </th>
<th class="px-4 py-2 text-right">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=reorder_point&direction={% if sort == 'reorder_point' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=reorder_point&direction={% if sort == 'reorder_point' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='reorder_point';document.querySelector('#filters input[name=direction]').value='{% if sort == 'reorder_point' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Reorder Point{% if sort == 'reorder_point' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
    </a>
  </th>
<th class="px-4 py-2">
  <a href="{% url 'items_list' %}?q={{ q|urlencode }}&active={{ active|urlencode }}&page_size={{ page_size }}&sort=is_active&direction={% if sort == 'is_active' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-get="{% url 'items_table' %}?sort=is_active&direction={% if sort == 'is_active' and direction == 'asc' %}desc{% else %}asc{% endif %}"
     hx-target="#items_table" hx-include="#filters"
     hx-on:click="document.querySelector('#filters input[name=sort]').value='is_active';document.querySelector('#filters input[name=direction]').value='{% if sort == 'is_active' and direction == 'asc' %}desc{% else %}asc{% endif %}'">
    Active{% if sort == 'is_active' %}{% if direction == 'asc' %} ▲{% else %} ▼{% endif %}{% endif %}
  </a>
</th>
<th class="px-4 py-2">Actions</th>
{% endblock %}

{% block rows %}
{% for row in page_obj %}
<tr class="odd:bg-gray-50 hover:bg-gray-100">
  <td class="px-4 py-2 text-right">{{ row.item_id }}</td>
  <td class="px-4 py-2">{{ row.name }}</td>
  <td class="px-4 py-2">{{ row.base_unit }}</td>
  <td class="px-4 py-2 text-right">{{ row.current_stock }}</td>
  <td class="px-4 py-2 text-right">{{ row.reorder_point }}</td>
  <td class="px-4 py-2">{{ row.is_active }}</td>
  <td class="px-4 py-2">
    <a href="{% url 'item_detail' row.item_id %}" class="text-primary mr-2">View</a>
    <a href="{% url 'item_edit' row.item_id %}" class="text-primary mr-2">Edit</a>
    <a href="{% url 'item_delete' row.item_id %}" class="text-primary">Delete/Deactivate</a>
  </td>
</tr>
{% empty %}
<tr>
  <td colspan="9" class="px-4 py-2">
    {% url 'item_create' as item_create_url %}
    {% include "components/empty_state.html" with title="No Items" message="No items found." cta_label="Add Item" cta_url=item_create_url %}
  </td>
</tr>
{% endfor %}
{% endblock %}

{% block footer %}
<div class="flex items-center gap-3 mt-3 flex-wrap">
    {% url 'items_table' as table_url %}
    {% with extra_query='q='|add:q|urlencode|add:'&active='|add:active|urlencode|add:'&page_size='|add:page_size|add:'&sort='|add:sort|urlencode|add:'&direction='|add:direction|urlencode %}
      {% include "components/pagination.html" with page_obj=page_obj base_url=table_url extra_query=extra_query hx_target="#items_table" hx_include="#filters" %}
    {% endwith %}
  <div class="ml-auto flex items-center gap-2">
    <label for="page_size" class="text-sm">Per page:</label>
    <input
      type="text"
      id="page_size"
      name="page_size"
      list="page_size_options"
      class="pagination-input"
      value="{{ page_size }}"
      form="filters"
      hx-get="{% url 'items_table' %}"
      hx-target="#items_table"
      hx-trigger="change"
      hx-include="#filters"
    />
    <datalist id="page_size_options">
      <option value="10"></option>
      <option value="25"></option>
      <option value="50"></option>
      <option value="100"></option>
    </datalist>
  </div>
</div>
{% endblock %}
