{% extends "components/form_layout.html" %}
{% block heading %}New Indent{% endblock %}
{% block form_attrs %}id="indent-form"{% endblock %}
{% block fields %}
  <div class="grid gap-4 grid-cols-2 max-sm:grid-cols-1">
    {% for field in form %}
      {% include "components/form_field.html" with field=field %}
    {% endfor %}
  </div>
  {{ formset.management_form }}
  {% if formset.non_form_errors %}
  <ul class="text-red-600 dark:text-red-400 list-disc pl-5">
    {% for error in formset.non_form_errors %}
      <li>{{ error }}</li>
    {% endfor %}
  </ul>
  {% endif %}
  <table id="items-table" class="table">
    <thead>
      <tr>
        <th>Item</th>
        <th>Qty</th>
        <th>Notes</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
    {% for item_form in formset %}
      <tr class="form-row">
        <td>{% include "components/form_field.html" with field=item_form.item %}</td>
        <td>{% include "components/form_field.html" with field=item_form.requested_qty %}</td>
        <td>{% include "components/form_field.html" with field=item_form.notes %}</td>
        <td><button type="button" class="remove-row btn-danger px-4 py-2 rounded">Remove</button></td>
      </tr>
    {% endfor %}
    </tbody>
  </table>
  <datalist id="item-options"></datalist>
  <div>
    <button type="button" id="add-row" class="btn-secondary mt-2 px-4 py-2 rounded">Add Item</button>
  </div>
{% endblock %}
{% block submit_text %}Submit{% endblock %}
{% block back_url %}{% url 'indents_list' %}{% endblock %}
{% block extra %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    initFormset({
      formsetPrefix: 'items',
      addButtonId: 'add-row',
      formContainer: '#items-table tbody',
      formClass: 'form-row',
      removeButtonClass: 'remove-row'
    });
  });
</script>
{% endblock %}
